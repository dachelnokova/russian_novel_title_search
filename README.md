# Поиск по заглавиям романов

Поиск по заголовкам русских романов тремя методами:

* **Полнотекстовый поиск (TF-IDF):**  Использует `sklearn.feature_extraction.text.TfidfVectorizer` для векторизации текста и косинусное сходство для поиска. Данные проходят предобработку, включающую приведение к нижнему регистру, токенизацию, удаление стоп-слов (nltk) и лемматизацию с помощью pymorphy2.
Удаление стоп-слов.
* **Векторный поиск (SBERT):**  Использует модель `sberbank-ai/sbert_large_nlu_ru`, поскольку она большая и предобучена на русских текстах (косинусное сходство для поиска). Предобработка текстов не реализовывалась, так как SBERT обучен на сырых текстах.
* **Гибридный поиск (TF-IDF + SBERT):**  Гибридный поиск комбинирует результаты полнотекстового (TF-IDF) и векторного (SBERT) поиска с помощью взвешенного усреднения оценок релевантности. Вес для каждого метода равен (0.5).


## Файлы
* `rus_novel_titles.csv`:  Датасет с заголовками русских романов, 2035 заглавий, 1763-1917 гг.
* `sbert_large_nlu_ru_embeddings.npy`:  Предобученные эмбеддинги SBERT для заголовков датасета.
* `tfidf_matrix.pkl`:  Матрица TF-IDF для заголовков датасета.
* `tfidf_vectorizer.pkl`:  Векторизатор TF-IDF.
* `search.py`:  Основной скрипт для поиска.
* `requirements.txt`:  Список необходимых библиотек.



## Запуск
1. Установка зависимостей:
```bash
pip install -r requirements.txt
```

2. Запуск скрипта:
На вход программа принимает такие параметры, как поисковый запрос, количество результатов для выдачи и метод поиска. На выходе - топ документов в порядке убывания релевантности, а также время исполнения программы.
```bash
python search.py --query "ваш запрос" --count <количество результатов> --method <метод поиска>  
```

Аргументы:  
--query: Поисковый запрос.  
--count: Количество результатов для выдачи.  
--method: Метод поиска (full_text, sbert, hybrid).  

## Примеры
```bash
python search.py --query "Отцы и дети" --count 5 --method full_text
```

```bash
# полнотекстовый поиск находит заглавия, где встречаются слова "отец", "дети"
Ваш поисковой запрос: Отцы и дети
Выбранный метод поиска: full_text
Количество результатов для выдачи: 5
Время исполнения: 0.0214 секунд
----------------------------------
1. Скор:  1.0000
Заглавие: Отцы и дети

2. Скор:  0.7284
Заглавие: Дети

3. Скор:  0.5384
Заглавие: Дети земли

4. Скор:  0.4754
Заглавие: Нежеланные дети

5. Скор:  0.4694
Заглавие: За грехи отца

```


```bash
python search.py --query "Отцы и дети" --count 5 --method vector
```

```bash
# векторный поиск более умный, нашел структурно и семантически близкие заглавия
Ваш поисковой запрос: Отцы и дети
Выбранный метод поиска: vector
Количество результатов для выдачи: 5
Время исполнения: 3.0316 секунд
----------------------------------
1. Скор:  1.0000
Заглавие: Отцы и дети

2. Скор:  0.8550
Заглавие: Мать и дочь

3. Скор:  0.8415
Заглавие: Мужья и жёны

4. Скор:  0.8145
Заглавие: Дед и внук

5. Скор:  0.8087
Заглавие: Дети

```


```bash
python search.py --query "Отцы и дети" --count 5 --method hybrid
```

```bash
Ваш поисковой запрос: Отцы и дети
Выбранный метод поиска: hybrid
Количество результатов для выдачи: 5
Время исполнения: 0.3202 секунд
----------------------------------
1. Скор:  1.0000
Заглавие: Отцы и дети

2. Скор:  0.7685
Заглавие: Дети

3. Скор:  0.4275
Заглавие: Мать и дочь

4. Скор:  0.4208
Заглавие: Мужья и жёны

5. Скор:  0.4073
Заглавие: Дед и внук
```


```bash
python search.py --query "мяу" --count 5 --method full_text
```

```bash
# Полнотекстовый поиск не справился, так как слова "мяу" в заглавиях не встречается
Ваш поисковой запрос: мяу
Выбранный метод поиска: full_text
Количество результатов для выдачи: 5
Время исполнения: 0.0058 секунд
----------------------------------
1. Скор:  0.0000
Заглавие: Моя весна

2. Скор:  0.0000
Заглавие: Идеалисты и реалисты

3. Скор:  0.0000
Заглавие: Царский суд

4. Скор:  0.0000
Заглавие: Мещане

5. Скор:  0.0000
Заглавие: Убийца

```


```bash
python search.py --query "мяу" --count 5 --method vector
```

```bash
# векторный поиск српавился, нашел семантически близкие заглавия к "мяу"
Ваш поисковой запрос: мяу
Выбранный метод поиска: vector
Количество результатов для выдачи: 5
Время исполнения: 0.2660 секунд
----------------------------------
1. Скор:  0.6423
Заглавие: Муся

2. Скор:  0.6285
Заглавие: Мура

3. Скор:  0.6238
Заглавие: Мимочка

4. Скор:  0.5934
Заглавие: Котик Летаев

5. Скор:  0.5784
Заглавие: Мыканье

```

```bash
python search.py --query "мяу" --count 5 --method hybrid
```

```bash
Ваш поисковой запрос: мяу
Выбранный метод поиска: hybrid
Количество результатов для выдачи: 5
Время исполнения: 0.3224 секунд
----------------------------------
1. Скор:  0.3211
Заглавие: Муся

2. Скор:  0.3142
Заглавие: Мура

3. Скор:  0.3119
Заглавие: Мимочка

4. Скор:  0.2967
Заглавие: Котик Летаев

5. Скор:  0.2892
Заглавие: Мыканье

```


```bash
python search.py --query "самолет" --count 5 --method full_text
```

```bash
# не сработало, слова самолет в заглавиях не встречается
Ваш поисковой запрос: самолет
Выбранный метод поиска: full_text
Количество результатов для выдачи: 5
Время исполнения: 0.0120 секунд
----------------------------------
1. Скор:  0.0000
Заглавие: Моя весна

2. Скор:  0.0000
Заглавие: Идеалисты и реалисты

3. Скор:  0.0000
Заглавие: Царский суд

4. Скор:  0.0000
Заглавие: Мещане

5. Скор:  0.0000
Заглавие: Убийца

```


```bash
python search.py --query "самолет" --count 5 --method vector
```

```bash
# сработало
Ваш поисковой запрос: самолет
Выбранный метод поиска: vector
Количество результатов для выдачи: 5
Время исполнения: 10.4666 секунд
----------------------------------
1. Скор:  0.6047
Заглавие: Капитон Перелетов

2. Скор:  0.5518
Заглавие: Новая метла

3. Скор:  0.5434
Заглавие: Метеор

4. Скор:  0.5371
Заглавие: Крылья

5. Скор:  0.5314
Заглавие: Корнет Отлетаев


```bash
python search.py --query "самолет" --count 5 --method hybrid
```

```bash
Ваш поисковой запрос: самолет
Выбранный метод поиска: hybrid
Количество результатов для выдачи: 5
Время исполнения: 10.5299 секунд
----------------------------------
1. Скор:  0.3023
Заглавие: Капитон Перелетов

2. Скор:  0.2759
Заглавие: Новая метла

3. Скор:  0.2717
Заглавие: Метеор

4. Скор:  0.2685
Заглавие: Крылья

5. Скор:  0.2657
Заглавие: Корнет Отлетаев

```

## Идеи для оценки качества поисковиков
Поскольку у нас заранее нет определенных правильных ответов ранжирования, можно использовать LLM или другую модель, обученную на оценку релевантности. Мы задаем LLM вопросы о каждом результате поиска, чтобы определить, насколько он соответствует запросу. LLM может ответить "релевантен", "не релевантен" или дать более детальную оценку по шкале. После этого считаем какую-нибудь метрику ранжирования, например, AP@K или MAP@K.  
- AP@K (Average Precision at K): Средняя точность на K элементах. Учитывает порядок результатов, присваивая больший вес релевантным результатам, найденным на более высоких позициях.
- MAP@K (Mean Average Precision at K) - это среднее значение AP@K для всех вопросов, заданных LLM для оценки релевантности.   






